Please refactor this full Python code to improve readability, reduce cyclomatic complexity, and improve maintainability. The functionality of this code should remain the same after refactoring